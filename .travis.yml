language: python

python:
  - "2.7"

virtualenv:
  system_site_packages: true

before_install:
  - if [[ $TRAVIS_PYTHON_VERSION == '2.6' ]]; then pip install --use-mirrors argparse; fi
  - pip install -r requirements.txt --use-mirrors
  - pip install -r dev_requirements.txt --use-mirrors
  - sudo apt-get update -qq
  - sudo apt-get install -qq ice34-services python-zeroc-ice

install: python omego/main.py -h

before_script:
    - psql -c "create user omero with password 'omero';" -U postgres
    - psql -c "create database omero with owner omero;" -U postgres
    - psql -c "select 1;" -U omero -h localhost omero
    - sudo mkdir /OMERO
    - sudo chown $USER:$USER /OMERO

script:
    - nosetests -d test
    - flake8 omego test

after_failure:
    - tail -n 1000 OMERO-CURRENT/var/log/Blitz-0.log
